# Руководство по тестированию Django проекта

## Обзор

Этот проект содержит комплексную систему тестирования, которая покрывает:

1. **Модели** - тестирование методов моделей, валидации и бизнес-логики
2. **Views** - тестирование кодов ответов, прав доступа и контекста
3. **Формы** - тестирование валидации и обработки данных
4. **Интеграционные тесты** - тестирование взаимодействия между компонентами
5. **Права доступа** - тестирование аутентификации и авторизации

## Структура тестов

```
blog/
├── postapp/
│   ├── tests.py              # Тесты моделей и форм postapp
│   └── test_views.py         # Тесты views postapp
├── users/
│   └── tests.py              # Тесты пользовательского приложения
├── integration_tests.py      # Интеграционные тесты
├── test_settings.py          # Настройки для тестирования
└── TESTING_README.md         # Это руководство
```

## Запуск тестов

### 1. Запуск всех тестов

```bash
python manage.py test
```

### 2. Запуск тестов конкретного приложения

```bash
# Тесты postapp
python manage.py test postapp

# Тесты users
python manage.py test users

# Интеграционные тесты
python manage.py test integration_tests
```

### 3. Запуск конкретного теста

```bash
# Тест конкретного класса
python manage.py test postapp.tests.EventModelTest

# Тест конкретного метода
python manage.py test postapp.tests.EventModelTest.test_event_creation
```

### 4. Запуск тестов с подробным выводом

```bash
python manage.py test --verbosity=2
```

### 5. Запуск тестов с покрытием кода

```bash
# Установка coverage (если не установлен)
pip install coverage

# Запуск тестов с покрытием
coverage run --source='.' manage.py test

# Просмотр отчета о покрытии
coverage report

# Генерация HTML отчета
coverage html
```

## Типы тестов

### 1. Тесты моделей (postapp/tests.py)

**EventCategoryTest**
- Проверка корректности определения категорий событий
- Проверка наличия конкретных категорий

**VenueModelTest**
- Тестирование создания места проведения
- Тестирование строкового представления
- Тестирование обязательных полей

**FestivalModelTest**
- Тестирование создания фестиваля
- Тестирование строкового представления

**EnsembleModelTest**
- Тестирование создания коллектива
- Тестирование строкового представления

**EventModelTest**
- Тестирование создания события
- Тестирование автоматической генерации slug
- Тестирование уникальности slug
- Тестирование сортировки событий
- Тестирование связей с другими моделями

### 2. Тесты форм (postapp/tests.py)

**EventFormTest**
- Тестирование валидных данных формы
- Тестирование невалидных данных
- Тестирование уникальности названия события

**ContactFormTest**
- Тестирование валидных данных формы контактов
- Тестирование невалидного email
- Тестирование пустых обязательных полей

### 3. Тесты views (postapp/test_views.py)

**IndexViewTest**
- Тестирование кода ответа главной страницы
- Тестирование использования правильного шаблона
- Тестирование контекста (последние события)

**EventsViewTest**
- Тестирование отображения только будущих событий
- Тестирование фильтрации по категории, месту проведения, коллективу
- Тестирование контекста страницы

**EventDetailViewTest**
- Тестирование детальной страницы события
- Тестирование 404 для несуществующего slug

**ArchiveViewTest**
- Тестирование требования авторизации
- Тестирование отображения только прошедших событий
- Тестирование фильтрации в архиве

**CreateEventViewTest**
- Тестирование требования авторизации для создания события
- Тестирование успешного создания события
- Тестирование автоматического назначения создателя

**ContactViewTest**
- Тестирование отправки формы контактов
- Тестирование обработки невалидных данных

**EnsembleListViewTest**
- Тестирование списка коллективов

### 4. Тесты аутентификации (postapp/test_views.py)

**AuthenticationTest**
- Тестирование доступа анонимного пользователя к публичным страницам
- Тестирование доступа анонимного пользователя к защищенным страницам
- Тестирование доступа авторизованного пользователя к защищенным страницам
- Тестирование изоляции данных пользователей

### 5. Тесты пользовательского приложения (users/tests.py)

**CustomUserModelTest**
- Тестирование создания пользователя
- Тестирование методов get_full_name и get_short_name
- Тестирование автоматически заполняемых полей
- Тестирование сортировки пользователей

**CustomUserCreationFormTest**
- Тестирование валидных данных формы регистрации
- Тестирование невалидных данных
- Тестирование несовпадения паролей
- Тестирование дублирования username и email

**CustomAuthenticationFormTest**
- Тестирование успешной аутентификации
- Тестирование неверных учетных данных

**UserProfileFormTest**
- Тестирование редактирования профиля
- Тестирование валидации email

**Views тесты (users/tests.py)**
- Тестирование регистрации, входа, выхода
- Тестирование просмотра и редактирования профиля
- Тестирование полного цикла аутентификации

### 6. Интеграционные тесты (integration_tests.py)

**UserEventIntegrationTest**
- Тестирование создания события пользователем
- Тестирование изоляции событий пользователей в архиве
- Тестирование требования авторизации для создания события

**AuthenticationFlowTest**
- Тестирование полного пути пользователя (регистрация → вход → создание события → редактирование профиля → выход)

**PermissionTest**
- Тестирование прав доступа для разных типов пользователей
- Тестирование изоляции данных между пользователями

**DataIntegrityTest**
- Тестирование каскадного удаления
- Тестирование SET_NULL при удалении связанных объектов
- Тестирование целостности связей ManyToMany

**BusinessLogicTest**
- Тестирование фильтрации будущих/прошедших событий
- Тестирование уникальности генерации slug
- Тестирование сортировки событий

## Настройки тестирования

Файл `test_settings.py` содержит специальные настройки для тестирования:

- In-memory SQLite база данных для быстрых тестов
- Отключение кэширования и логирования
- Настройки для тестирования email и файлов
- Отключение отладки и безопасности для тестов

## Лучшие практики

### 1. Организация тестов

- Каждый тест должен быть независимым
- Используйте setUp() для создания тестовых данных
- Группируйте связанные тесты в классы
- Давайте описательные имена тестам

### 2. Покрытие тестами

- Тестируйте как успешные, так и неуспешные сценарии
- Тестируйте граничные случаи
- Тестируйте бизнес-логику
- Тестируйте права доступа

### 3. Производительность

- Используйте in-memory базу данных для тестов
- Минимизируйте количество запросов к базе данных
- Используйте setUp() вместо создания данных в каждом тесте

### 4. Читаемость

- Пишите понятные сообщения об ошибках
- Используйте комментарии для объяснения сложной логики
- Следуйте принципу AAA (Arrange, Act, Assert)

## Примеры использования

### Запуск тестов с фильтрацией

```bash
# Запуск только тестов моделей
python manage.py test postapp.tests.EventModelTest

# Запуск тестов с определенным паттерном
python manage.py test --pattern="test_*_creation"

# Запуск тестов с исключением
python manage.py test --exclude="test_views"
```

### Отладка тестов

```bash
# Запуск с подробным выводом
python manage.py test --verbosity=3

# Запуск с остановкой на первой ошибке
python manage.py test --failfast

# Запуск с сохранением базы данных
python manage.py test --keepdb
```

### Генерация отчетов

```bash
# Отчет о покрытии кода
coverage run --source='.' manage.py test
coverage report -m

# HTML отчет
coverage html
# Откроется в браузере: htmlcov/index.html
```

## Добавление новых тестов

### 1. Создание теста для новой модели

```python
class NewModelTest(TestCase):
    def setUp(self):
        # Создание тестовых данных
        pass
    
    def test_model_creation(self):
        # Тест создания объекта
        pass
    
    def test_model_methods(self):
        # Тест методов модели
        pass
```

### 2. Создание теста для нового view

```python
class NewViewTest(ViewsTestCase):
    def test_view_status_code(self):
        response = self.client.get(reverse('app:view_name'))
        self.assertEqual(response.status_code, 200)
    
    def test_view_template(self):
        response = self.client.get(reverse('app:view_name'))
        self.assertTemplateUsed(response, 'app/template.html')
```

### 3. Создание интеграционного теста

```python
class NewIntegrationTest(IntegrationTestCase):
    def test_integration_scenario(self):
        # Тестирование взаимодействия компонентов
        pass
```

## Мониторинг качества

### Метрики покрытия

- **Модели**: 95%+
- **Views**: 90%+
- **Формы**: 95%+
- **Интеграционные тесты**: 80%+

### Автоматизация

Рекомендуется настроить автоматический запуск тестов:

1. При каждом коммите (pre-commit hooks)
2. При создании pull request
3. Ежедневно (CI/CD pipeline)

### Непрерывная интеграция

Пример GitHub Actions workflow:

```yaml
name: Tests
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: 3.9
    - name: Install dependencies
      run: pip install -r requirements.txt
    - name: Run tests
      run: python manage.py test
    - name: Generate coverage report
      run: |
        coverage run --source='.' manage.py test
        coverage report
```

## Заключение

Эта система тестирования обеспечивает:

- **Надежность**: Все критические функции покрыты тестами
- **Безопасность**: Права доступа тщательно протестированы
- **Качество**: Бизнес-логика проверена на различных сценариях
- **Поддерживаемость**: Легко добавлять новые тесты и поддерживать существующие

Регулярно запускайте тесты и следите за покрытием кода для поддержания высокого качества проекта. 