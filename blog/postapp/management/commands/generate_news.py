from django.core.management.base import BaseCommand
from django.contrib.auth import get_user_model
from postapp.models import News, NewsCategory
from mixer.backend.django import mixer
import random

User = get_user_model()

class Command(BaseCommand):
    help = 'Генерирует тестовые новости с помощью mixer'

    def add_arguments(self, parser):
        parser.add_argument(
            '--count',
            type=int,
            default=10,
            help='Количество новостей для генерации (по умолчанию: 10)'
        )

    def handle(self, *args, **options):
        count = options['count']
        
        # Получаем или создаем тестового пользователя
        try:
            user = User.objects.first()
            if not user:
                user = mixer.blend(User, username='admin', email='admin@example.com')
                user.set_password('admin123')
                user.save()
                self.stdout.write(f'Создан тестовый пользователь: {user.username}')
        except Exception as e:
            self.stdout.write(self.style.ERROR(f'Ошибка при создании пользователя: {e}'))
            return

        # Список заголовков новостей
        titles = [
            "Открытие нового концертного зала в центре города",
            "Фестиваль классической музыки пройдет в этом месяце",
            "Интервью с известным дирижером",
            "Анонс: Большой симфонический концерт",
            "Новый театральный сезон начинается",
            "Музыкальная школа объявляет набор",
            "Концерт органной музыки в кафедральном соборе",
            "Фольклорный ансамбль выступит на главной площади",
            "Детский музыкальный фестиваль 'Весенние голоса'",
            "Открытие выставки музыкальных инструментов",
            "Мастер-класс по игре на скрипке",
            "Концерт джазовой музыки в парке",
            "Театральная премьера сезона",
            "Музыкальный вечер в библиотеке",
            "Фестиваль уличных музыкантов",
            "Концерт камерной музыки",
            "Выступление хора ветеранов",
            "Музыкальная гостиная для детей",
            "Концерт народных инструментов",
            "Джазовый фестиваль 'Чита-Джаз'"
        ]

        # Список содержаний новостей
        contents = [
            "В центре города состоялось торжественное открытие нового концертного зала. Современное здание оборудовано по последнему слову техники и готово принимать артистов мирового уровня. В день открытия состоялся концерт симфонического оркестра.",
            
            "Ежегодный фестиваль классической музыки пройдет в нашем городе с 15 по 25 числа текущего месяца. В программе фестиваля концерты известных исполнителей, мастер-классы и творческие встречи.",
            
            "В рамках культурной программы города состоялась встреча с известным дирижером. В интервью он рассказал о своем творческом пути, планах на будущее и поделился секретами мастерства.",
            
            "Большой симфонический концерт состоится в главном концертном зале города. В программе произведения Чайковского, Рахманинова и современных композиторов. Билеты уже в продаже.",
            
            "Новый театральный сезон открывается премьерой спектакля по пьесе классика русской литературы. Режиссер постановки обещает зрителям незабываемые впечатления и новые интерпретации известного произведения.",
            
            "Музыкальная школа имени известного композитора объявляет набор учащихся на новый учебный год. Принимаются дети от 6 лет. Обучение проводится по различным специальностям: фортепиано, скрипка, гитара, вокал.",
            
            "В кафедральном соборе состоится концерт органной музыки. В программе произведения Баха, Моцарта и других композиторов. Уникальная акустика храма создаст особую атмосферу для восприятия музыки.",
            
            "Фольклорный ансамбль 'Родные напевы' выступит на главной площади города. В программе народные песни, танцы и обряды. Мероприятие приурочено к празднованию Дня города.",
            
            "Детский музыкальный фестиваль 'Весенние голоса' соберет юных талантов со всего региона. В течение трех дней будут проходить конкурсы, мастер-классы и гала-концерт победителей.",
            
            "В краеведческом музее открывается выставка музыкальных инструментов. Посетители смогут увидеть редкие экспонаты, узнать историю их создания и даже попробовать сыграть на некоторых инструментах.",
            
            "Известный скрипач проведет мастер-класс для учащихся музыкальных школ города. В программе занятия по технике игры, интерпретации произведений и творческая встреча с мастером.",
            
            "В городском парке состоится концерт джазовой музыки. Выступят местные джазовые коллективы и приглашенные музыканты. Мероприятие пройдет под открытым небом.",
            
            "Театральная премьера сезона обещает стать главным культурным событием осени. Режиссер постановки использует современные технологии и нестандартные решения для создания уникального зрелища.",
            
            "В центральной библиотеке состоится музыкальный вечер. В программе выступление камерного ансамбля, чтение стихов и обсуждение литературно-музыкальных произведений.",
            
            "Фестиваль уличных музыкантов соберет талантливых исполнителей со всего города. В течение дня на различных площадках будут звучать разные стили музыки.",
            
            "Концерт камерной музыки пройдет в уютном зале музыкального училища. В программе произведения для струнного квартета и фортепианного трио.",
            
            "Хор ветеранов 'Память сердца' выступит с концертной программой. В репертуаре песни военных лет, народные и современные произведения.",
            
            "Музыкальная гостиная для детей приглашает юных слушателей на интерактивный концерт. Дети смогут не только послушать музыку, но и поучаствовать в музыкальных играх.",
            
            "Концерт народных инструментов представит богатство русской музыкальной культуры. В программе выступление ансамбля народных инструментов и солистов.",
            
            "Джазовый фестиваль 'Чита-Джаз' станет главным музыкальным событием лета. В течение недели будут проходить концерты, джем-сейшены и мастер-классы."
        ]

        # Список кратких описаний
        excerpts = [
            "Торжественное открытие нового концертного зала в центре города.",
            "Ежегодный фестиваль классической музыки пройдет в этом месяце.",
            "Интервью с известным дирижером о творчестве и планах.",
            "Анонс большого симфонического концерта.",
            "Новый театральный сезон начинается с премьеры.",
            "Музыкальная школа объявляет набор учащихся.",
            "Концерт органной музыки в кафедральном соборе.",
            "Фольклорный ансамбль выступит на главной площади.",
            "Детский музыкальный фестиваль 'Весенние голоса'.",
            "Выставка музыкальных инструментов в музее.",
            "Мастер-класс по игре на скрипке.",
            "Концерт джазовой музыки в парке.",
            "Театральная премьера сезона.",
            "Музыкальный вечер в библиотеке.",
            "Фестиваль уличных музыкантов.",
            "Концерт камерной музыки.",
            "Выступление хора ветеранов.",
            "Музыкальная гостиная для детей.",
            "Концерт народных инструментов.",
            "Джазовый фестиваль 'Чита-Джаз'."
        ]

        created_count = 0
        
        for i in range(count):
            try:
                # Выбираем случайные данные
                title = random.choice(titles)
                content = random.choice(contents)
                excerpt = random.choice(excerpts)
                category = random.choice(list(NewsCategory.choices))[0]
                
                # Создаем новость
                news = mixer.blend(
                    News,
                    title=title,
                    content=content,
                    excerpt=excerpt,
                    category=category,
                    author=user,
                    is_published=True
                )
                
                created_count += 1
                self.stdout.write(f'Создана новость: {news.title}')
                
            except Exception as e:
                self.stdout.write(self.style.ERROR(f'Ошибка при создании новости: {e}'))
                continue

        self.stdout.write(
            self.style.SUCCESS(
                f'Успешно создано {created_count} новостей из {count} запрошенных'
            )
        ) 